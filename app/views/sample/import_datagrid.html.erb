<style>
  #content-heading {                                                                 
    color: #404040;                                                               
    font-family: Verdana,Tahoma,Arial;                                            
    font-size: 14px;                                                              
    width: 99%;   
    background: none repeat scroll 0 0 rgb(255, 235, 144);                      
    height: auto;                                                               
    border: 1px solid #696969;                                                              
    padding: 10px;
  }

  #content-data {                                                                 
    color: black;                                                               
    font-family: Verdana,Tahoma,Arial;                                            
    font-size: 14px;                                                              
    width: 99%;   
    background-color: white;                      
    height: auto;                                                               
    padding: 10px;
  }

  #search_results {
    font-size: 10px;
    border-style: solid;
    border-width: 1px;
  }  

  #search_results td , th{
    font-size: 10px;
    border-style: solid;
    border-width: 1px;
  }  

  .input_data {
    width:120px;
  }
</style>

<%= stylesheet_link_tag "DatePicker/jsDatePick_ltr.min" %> 
<%= javascript_include_tag "DatePicker/jsDatePick.min.1.3" %>

<script>
 var currDate = new Date();
 var dateNow =  currDate.getDate();
 var yrNow =  currDate.getFullYear();
 var monthNow =  (currDate.getMonth() + 1);

 function setDate(element){
    new JsDatePick({
      useMode:2,
      target: element.id ,
      dateFormat:"%d-%M-%Y",
      selectedDate:{       
        day: dateNow,            
        month: monthNow,
        year: yrNow
      },
      yearsRange:[2000,yrNow],
      limitToToday: true,
      cellColorScheme:"beige",
      dateFormat:"%d-%m-%Y",
      imgPath:"img/",
      weekStartDay:1
    });
  };

    function insertRow(e , ev) {
      if(ev.keyCode == 13) {
        saveRecord(document.getElementById(parseInt(e.id) - 6));                                                                                
        return;
      }
    }

    function addRow() {
        var colCount = 8
        var table = document.getElementById('search_results');

        var rowCount = table.rows.length;
        var row = table.insertRow(rowCount - 1);

        
        for(var i = 0; i < colCount; i++) {
          cell = row.insertCell(i);
          classRow = " row" + rowCount;
          name = "XXX";
          colID = (parseInt(rowCount) + parseInt(i) + 10);
          valueEntered = document.getElementById(i).value;
          document.getElementById(i).value = null;

          if(i == 7) {
            element = "<input disabled='disabled' class='input_data" + classRow + "' type='text' name='" + name + "' id='" + colID + "' value='" + valueEntered +"'/>";
            setDate(document.getElementById(parseInt(rowCount) + 10));
            document.getElementById(0).focus();
          }else if(i == 6){
            element = "<input onkeyup='insertRow(this,event);sampleIodineCategory(this);' onchange = 'sampleIodineCategory(this);'  class='input_data" + classRow + "' type='text' name='" + name + "' id='" + colID + "' value='" + valueEntered +"'/>";
          }else{
            element = "<input class='input_data" + classRow + "' type='text' name='" + name + "' id='" + colID + "' value='" + valueEntered +"'/>";
          }
          cell.innerHTML = element;
        }
/*
*/
    }
</script>


<div class="page-header">                                                       
  <h1>import <small>quality monitoring</small></h1>                              
</div>

<div id = "content-data">                                                     

<section id='modals'>                                              
  
  <table id='search_results' class='table table-striped table-bordered table-condensed'>
  <thead>                                                                       
  <tr id = 'table_head'>                                                        
    <th id="th3" style="width:20px;">Date</th>                                 
    <th id="th1" style="width:20px;">IIR Code</th>                               
    <th id="th4" style="width:20px;">Point of Entry</th>                             
    <th id="th5" style="width:20px;">Importer</th>                                
    <th id="th5" style="width:20px;">Brand</th>                                
    <th id="th5" style="width:20px;">Volume of import (tons)</th>                                
    <th id="th5" style="width:20px;">Result</th>                                
    <th id="th5" style="width:20px;">Category</th>                                
  </tr>                                                                         
  </thead>                                                                      
  <tbody id='results'>                                                          
    <tr>                                                                        
      <td><input type="text" name="date" class='input_data' id="0" /></td>
      <td><input type="text" name="iir_code" class='input_data' id="1" /></td>                                                      
      <td>
        <%@borders.unshift('Select entry point') %>                      
        <%= select_tag "border", options_for_select(@borders), 
            :class => "input_data", :id => "2" %>
      </td>
      <td>
        <%@salt_types.unshift('Select salt type') %>                      
        <%= select_tag "type", options_for_select(@salt_types), 
            :class => "input_data", :id => "3" %>
      </td>                                                      
      <td>
        <%@manufacturers.unshift('Select manufacturer') %>                      
        <%= select_tag "brand", options_for_select(@manufacturers), 
            :class => "input_data", :id => "4" %>
      </td>                                                      
      <td><input type="text" name="volume" class='input_data' id="5" /></td>                                                      
      <td>
        <input type="text" name="result" class='input_data' onkeyup="insertRow(this,event);sampleIodineCategory(this);" onchange = "sampleIodineCategory(this);" id="6" />
      </td>
      <td><input disabled='disabled' type="text" name="category" class='input_data' id="7" /></td>
    </tr>                                                                       
  </tbody>                                                                      
</table>                                                                      
</section> 

</div>

<script>

function sampleIodineCategory(element) {                                               
  sampleIodineLevelID = (parseInt(element.id) + 1);
  sample_iodine_category = document.getElementById(sampleIodineLevelID);
                                                          
  try{                                                                          
    var level = parseFloat(element.value);                          
    if(!level) {                                                                
      sample_iodine_category.value = null;                                      
      return;                                                                   
    }                                                                           
  }catch(e){}                                                                   
                                                          
  if(level < 45){                                                               
    sample_iodine_category.value = "Below Market Min";                          
  }else if(level >= 45 && level <= 49.9 ){                                      
    sample_iodine_category.value = "Factory Min-Market Min";                    
  }else if(level < 50){                                                         
    sample_iodine_category.value = "< Factory Min";                             
  }else if(level >= 50 && level <= 84){                                         
    sample_iodine_category.value = "Production Range";                          
  }else if(level > 84){                                                         
    sample_iodine_category.value = "> Factory Max";                             
  }                                                                             

}

function saveRecord(element) {                                                           
  var selected_date = element;            
  var elementID = parseInt(element.id);
  var iir_code = document.getElementById(elementID + 1); 
  var entry = document.getElementById(elementID + 2); 
  var importer = document.getElementById(elementID + 3); 
  var brand = document.getElementById(elementID + 4); 
  var volume = document.getElementById(elementID + 5); 
  var entered_result = document.getElementById(elementID + 6); 
  var cat = document.getElementById(elementID + 7); 

  if (selected_date.value.length < 1) {
  }else if(iir_code.value.length < 1) {
  }else if(entry.value.length < 1) {
  }else if(importer.value.length < 1) {
  }else if(brand.value.length < 1) {
  }else if(volume.value.length < 1) {
  }else if(entered_result.value.length < 1) {
  }else if(cat.value.length < 1) {
  }

  var url = "sample[iir_code]=" + iir_code.value;                                                                         
  url += "&sample[border]=" + entry.value;                                                                         
  url += "&sample[importer]=" + importer.value;                                                                         
  url += "&sample[salt_type]=" + brand.value;                                                                         
  url += "&sample[country]=" + 2;                                                                         
  url += "&sample[volume]=" + volume.value;                                                                         
  url += "&sample[iodine_level]=" + entered_result.value;                                                                         
  url += "&sample[category]=" + cat.value;                                                                         
  url += "&sample[date]=" + selected_date.value;                                                                         

  addRow(); 
  return;

  if (window.XMLHttpRequest) {// code for IE7+, Firefox, Chrome, Opera, Safari  
      xmlhttp=new XMLHttpRequest();                                             
    }else{// code for IE6, IE5                                                  
      xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");                           
    }                                                                           
    xmlhttp.onreadystatechange=function() {                                     
      if (xmlhttp.readyState==4 && xmlhttp.status==200) {                       
        var results = xmlhttp.responseText;                                     
        if(results) {                           
        }                                                                     
      }                                                                         
    }  
    
    
    xmlhttp.open("GET","/create_quality_monitoring_raw_data?" + url, true);           
    xmlhttp.send();                                                             
  }
  
  setDate(document.getElementById(0));

</script>
