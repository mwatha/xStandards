<style>
  #content-heading {                                                                 
    color: #404040;                                                               
    font-family: Verdana,Tahoma,Arial;                                            
    font-size: 14px;                                                              
    width: 99%;   
    background: none repeat scroll 0 0 rgb(255, 235, 144);                      
    height: auto;                                                               
    border: 1px solid #696969;                                                              
    padding: 10px;
  }

  #content-data {                                                                 
    color: black;                                                               
    font-family: Verdana,Tahoma,Arial;                                            
    font-size: 14px;                                                              
    width: 99%;   
    background-color: white;                      
    height: auto;                                                               
    padding: 10px;
  }

  #search_results {
    font-size: 10px;
    border-style: solid;
    border-width: 1px;
  }  

  #search_results td , th{
    font-size: 10px;
    border-style: solid;
    border-width: 1px;
  }  

  #content-line-graph {                                                                
    font-size: 12px;                                                              
    width: 100%;                                                                 
    border: 1px solid #E4E4E4;                                                    
    margin-bottom: 10px;                                                          
    padding: 6px;                                                                 
    float: right;                                                                 
  }
  
</style>

<%= stylesheet_link_tag "DatePicker/jsDatePick_ltr.min" %> 
<%= javascript_include_tag "DatePicker/jsDatePick.min.1.3" %>

<script>
 var currDate = new Date();
 var dateNow =  currDate.getDate();
 var yrNow =  currDate.getFullYear();
 var monthNow =  (currDate.getMonth() + 1);

 function startDate(){
    new JsDatePick({
      useMode:2,
      target:"report_start_date",
      dateFormat:"%d-%M-%Y",
      selectedDate:{       
        day: dateNow,            
        month: monthNow,
        year: yrNow
      },
      yearsRange:[2000,yrNow],
      limitToToday: true,
      cellColorScheme:"beige",
      dateFormat:"%d-%m-%Y",
      imgPath:"img/",
      weekStartDay:1
    });
  };

 function endDate(){
    new JsDatePick({
      useMode:2,
      target:"report_end_date",
      dateFormat:"%d-%M-%Y",
      selectedDate:{       
        day: dateNow,            
        month: monthNow,
        year: yrNow
      },
      yearsRange:[2000,yrNow],
      limitToToday: true,
      cellColorScheme:"beige",
      dateFormat:"%d-%m-%Y",
      imgPath:"img/",
      weekStartDay:1
    });
  };

 function getData() {                                                       
    var start_date = document.getElementById('report_start_date').value;               
    var end_date = document.getElementById('report_end_date').value;               
    var representation = document.getElementById('data-representation').value;
    //document.getElementById('container').innerHTML = '';                                                           
                                                                                
    if (window.XMLHttpRequest) {// code for IE7+, Firefox, Chrome, Opera, Safari  
        xmlhttp=new XMLHttpRequest();                                             
      }else{// code for IE6, IE5                                                  
        xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");                           
      }                                                                           
      xmlhttp.onreadystatechange=function() {                                     
        if (xmlhttp.readyState==4 && xmlhttp.status==200) {                       
          var results = xmlhttp.responseText;                                     
          if(results == 'undefined' || results == '' || results == '"not validate"') {                           
            document.getElementById('content-data').innerHTML = "....";
            return;                                                               
          }else if(results.length > 0){
            //document.getElementById('container').innerHTML = '';                                                           
            if (representation == 'line-graph') {
              fetched_data = {};
              results = JSON.parse(results);
              for(var key in results) {
                fetched_data[key] = results[key];
              }
              loadGraph();
            }
          }else{
            document.getElementById('content-data').innerHTML = "....";
            return;
          }                                             
        }                                                                         
      }                                                                           
      xmlhttp.open("GET","/reportlevels?start_date="+start_date + "&end_date=" + end_date + "&reps=" + representation,true);           
      xmlhttp.send();                                                             
    }  

    var fetched_data = {};

    //fetched_data['Dedza'] = [21.5, 25.2, 26.5, 23.3, 18.3, 13.9, 9.6];
    //fetched_data['Lilongwe'] = [-0.9, 0.6, 3.5, 8.4, 13.5, 17.0, 18.6, 17.9, 14.3, 9.0, 3.9, 1.0];
    //fetched_data['Dowa'] = [3.9, 4.2, 5.7, 8.5, 11.9, 15.2, 17.0, 16.6, 14.2, 10.3, 6.6, 4.8];
</script>


<div class="page-header">                                                       
  <h1>report <small>production level</small></h1>                              
</div>

<div id = "content-heading">                                                     
  <table style="width: 99%;">
    <tr>
      <td><%=text_field(:report, :start_date ,:placeholder => "Start date") %></td>
      <td style="text-align:right;"><%=text_field(:report, :representation ,
        :placeholder => "Data representation",:disabled => 'disabled') %>
        &nbsp;
        <%
          representation = [
            ['line-graph','line-graph'],
            ['table','table'],
          ]
        %>
        <%= select_tag "data-representation", 
          options_for_select(representation),
          :placeholder => "Select store room location" %>
      </td>
    </tr>
    <tr>
      <td><%=text_field(:report, :end_date ,:placeholder => "End date") %></td>
      <td>
          <input onclick="getData();" type="button" id="signup"                
          class="btn btn-primary signup_btn" value="Apply" style="width:100%;" />
      </td>
    </tr>
  </table>
</div>

<br><hr /></br>

<div id = "content-data">                                                     

<section id='modals'>                                              
  <div id = "content-line-graph">
    <%= render :partial => "report/line_graph" %>
  </div>
</section> 

</div>

<script>
  startDate();
  endDate();
</script>
